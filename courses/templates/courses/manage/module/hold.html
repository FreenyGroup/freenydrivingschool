<div class="lg:container w-full flex flex-wrap mx-auto px-2">
  <section class="w-full">
   <div id='section2' class="p-8 mt-8 rounded shadow bg-white">
        <form id="form-container" method="POST">
        <h2 class="mb-4 text-4xl tracking-tight font-extrabold text-center text-gray-900 dark:text-white">Edit/Add Course Modules</h2>
        <p class="mb-4 lg:mb-8 font-light text-center text-gray-500 dark:text-gray-400 sm:text-xl">Got a technical issue? Want to send feedback about a beta feature? Need details about our Business plan? Let us know.</p>
        <div class="mb-4 lg:mb-8 p-2 flex">
            <div class="md:w-1/3"></div>
            <div class="md:w-2/3 flex justify-start">
                <button id="add-form" type="button" class="text-white bg-primary hover:bg-[#FF9119]/80 focus:ring-4 focus:outline-none focus:ring-[#FF9119]/50 font-medium rounded-lg text-sm px-5 py-2.5 text-center inline-flex items-center dark:hover:bg-[#FF9119]/80 dark:focus:ring-[#FF9119]/40 mr-2 mb-2">
                    <svg class="mr-2 -ml-1 w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v3m0 0v3m0-3h3m-3 0H9m12 0a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>                    
                    Add Another Module
                </button>                
                <button type="submit" class="text-white bg-secondary focus:ring-4 focus:outline-none focus:ring-[#050708]/50 font-medium rounded-lg text-sm px-5 py-2.5 text-center inline-flex items-center dark:hover:bg-[#050708]/40 dark:focus:ring-gray-600 mr-2 mb-2">
                    Save Module's
                    <svg class="ml-2 -mr-1 w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>                  </button>
            </div>
        </div>
          {% csrf_token %}
          {{formset.management_form}}
          {% for form in formset %}
          <div class="bird-form">
              <div class="md:flex mb-6">
                  <div class="md:w-1/3">
                      <label class="block text-gray-600 font-bold md:text-left mb-3 md:mb-0 pr-4" for="my-textfield">
                          {{ form.title.label }}
                      </label>
                  </div>
                  <div class="md:w-2/3">
                      {{ form.title }}                    
                      <p class="py-2 text-sm text-gray-600">add notes about populating the field</p>
                  </div>
              </div>
     
              <div class="md:flex mb-6">
                  <div class="md:w-1/3">
                      <label class="block text-gray-600 font-bold md:text-left mb-3 md:mb-0 pr-4" for="my-textarea">
                          {{ form.description.label }} 
                      </label>
                  </div>
                  <div class="md:w-2/3">
                      {{form.description}}
                      <p class="py-2 text-sm text-gray-600">add notes about populating the field</p>
                  </div>
              </div>
          </div>
          <hr class="bg-gray-300 my-12">
          {% endfor %}
           <div id="test"></div>
       </form
  
   </div>
   <hr class="bg-gray-300 my-12">
  </section>
</div>

<form id="form-container" method="POST">
    {% csrf_token %}
    {{formset.management_form}}
    {% for form in formset %}
    <div>
        {% form.as_p %}
    </div>
    <div class="bird-form">
        {% for fld in form.hidden_fields %}{{ fld }}{% endfor %}
        {% if form.instance.pk %}{{ form.DELETE }}{% endif %}
        {{ form.title }}
        {{ form.description }}
    </div>
    <div id='empty-form' class='hidden'>{{ formset.empty_form|crispy }}</div>
    {% endfor %}
    <button id="add-form" type="button">Add Another Bird</button>
    <button type="submit">Create Birds</button>
</form>
<form action='.' method="POST" hx-post='.' hx-swap='outerHTML'>
    {% csrf_token %}
    {% if message %}
    <p>{{ message }}</p>
    {% endif %}


    {% if formset %}
    <h3>Ingredients</h3>
    {{ formset.management_form }}
    <div id='ingredient-form-list'>
        {% for form in formset %}
                <div class='ingredient-form'>
                    {{ form|crispy }}
                </div>
        {% endfor %}
    </div>

    <div id='empty-form' class='hidden'>{{ formset.empty_form|crispy }}</div>
    <button id='add-more' type='button'>Add more</button>
    {% endif %}
    <button style='margin-top:10px;' type='submit' >Save</button>
</form>

<div class="lg:container w-full flex flex-wrap mx-auto px-2">
    <section class="w-full">
     <div id='section2' class="p-8 mt-8 rounded shadow bg-white">
          <form id="form-container" action='.' method="POST" hx-post='.' hx-swap='outerHTML'>
          <h2 class="mb-4 text-4xl tracking-tight font-extrabold text-center text-gray-900 dark:text-white">Edit/Add Course Modules</h2>
          <p class="mb-4 lg:mb-8 font-light text-center text-gray-500 dark:text-gray-400 sm:text-xl">Got a technical issue? Want to send feedback about a beta feature? Need details about our Business plan? Let us know.</p>
          <div class="mb-4 lg:mb-8 p-2 flex">
              <div class="md:w-1/3"></div>
              <div class="md:w-2/3 flex justify-start">
                  <button id='add-more' type="button" class="text-white bg-primary hover:bg-[#FF9119]/80 focus:ring-4 focus:outline-none focus:ring-[#FF9119]/50 font-medium rounded-lg text-sm px-5 py-2.5 text-center inline-flex items-center dark:hover:bg-[#FF9119]/80 dark:focus:ring-[#FF9119]/40 mr-2 mb-2">
                      <svg class="mr-2 -ml-1 w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v3m0 0v3m0-3h3m-3 0H9m12 0a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>                    
                      Add Another Module
                  </button>                
                  <button type="submit" class="text-white bg-secondary focus:ring-4 focus:outline-none focus:ring-[#050708]/50 font-medium rounded-lg text-sm px-5 py-2.5 text-center inline-flex items-center dark:hover:bg-[#050708]/40 dark:focus:ring-gray-600 mr-2 mb-2">
                      Save Module's
                      <svg class="ml-2 -mr-1 w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>                  </button>
              </div>
          </div>
            {% csrf_token %}
            {{formset.management_form}}
            <div id="ingredient-form-list">
            {% for form in formset %}
            <div class='ingredient-form'>
                <div class="md:flex mb-6">
                    <div class="md:w-1/3">
                        <label class="block text-gray-600 font-bold md:text-left mb-3 md:mb-0 pr-4" for="my-textfield">
                            {{ form.title.label }}
                        </label>
                    </div>
                    <div class="md:w-2/3">
                        {{ form.title|as_crispy_field }}                    
                        <p class="py-2 text-sm text-gray-600">add notes about populating the field</p>
                    </div>
                </div>
       
                <div class="md:flex mb-6">
                    <div class="md:w-1/3">
                        <label class="block text-gray-600 font-bold md:text-left mb-3 md:mb-0 pr-4" for="my-textarea">
                            {{ form.description.label }} 
                        </label>
                    </div>
                    <div class="md:w-2/3">
                        {{ form.description|as_crispy_field }}
                        <p class="py-2 text-sm text-gray-600">add notes about populating the field</p>
                    </div>
                </div>
            </div>
            <hr class="bg-gray-300 my-12">
            <div id='empty-form' class='hidden'>{{ formset.empty_form|crispy }}</div>
            {% endfor %}
        </div>
        </form>
    
     </div>
     <hr class="bg-gray-300 my-12">
    </section>
</div>
<script>
    let birdForm = document.querySelectorAll(".bird-form")
    let container = document.querySelector("#form-container")
    let addButton = document.querySelector("#add-form")
    let totalForms = document.querySelector("#id_modules-TOTAL_FORMS")

    let formNum = birdForm.length-1
    addButton.addEventListener('click', addForm)

    function addForm(e){
        e.preventDefault()

        let newForm = birdForm[1].cloneNode(true)
        let formRegex = RegExp(`form-(\\d){1}-`,'g')

        formNum++
        newForm.innerHTML = newForm.innerHTML.replace(formRegex, `form-${formNum}-`)
        container.insertBefore(newForm, addButton)
        
        totalForms.setAttribute('value', `${formNum+1}`)
    }
</script>